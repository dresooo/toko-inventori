<section id="step-order"
    class="w-full min-h-screen py-20 bg-base-100 relative snap-start flex items-center justify-center">
    <div class="relative w-full max-w-5xl mx-auto px-6">
        <h2 class="text-3xl font-bold text-center mb-16">Simple Steps to Your Perfect Product</h2>

        <div class="absolute left-1/2 top-32 bottom-0 w-1 -translate-x-1/2 overflow-hidden">
            <div class="h-full bg-gray-300"></div>

            <div id="progressLine" class="absolute top-0 left-0 w-full bg-primary transition-all duration-700 ease-out"
                style="height: 0%"></div>
        </div>

        <div class="space-y-32">
            <div class="step-item flex items-center relative transition-all duration-700" data-step="1">
                <div class="w-1/2 flex justify-end pr-12">
                    <div
                        class="icon-wrapper w-20 h-20 rounded-full bg-gray-300 flex items-center justify-center transition-all duration-700">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                            class="h-14 w-14 stroke-current text-white">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                        </svg>
                    </div>
                </div>
                <div class="w-1/2 pl-12">
                    <h3 class="text-xl font-semibold text-black mb-2">1. Choose Product</h3>
                    <p class="text-gray-500">Begin your journey by selecting the product type and design style that fits
                        your personality. After that, you can easily customize every detail to create something uniquely
                        yours.</p>
                </div>
            </div>

            <div class="step-item flex items-center relative opacity-100 transition-all duration-700" data-step="2">
                <div class="w-1/2 text-right pr-12">
                    <h3 class="text-xl font-semibold text-black mb-2">2. Order</h3>
                    <p class="text-gray-500">Fill in your order details and review them before confirming your request
                        to ensure everything is correct.</p>
                </div>
                <div class="w-1/2 flex justify-start pl-12">
                    <div
                        class="icon-wrapper w-20 h-20 rounded-full bg-gray-300 flex items-center justify-center transition-all duration-700">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                            class="h-13 w-13 stroke-current text-white">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
                        </svg>
                    </div>
                </div>
            </div>

            <div class="step-item flex items-center relative opacity-100 transition-all duration-700" data-step="3">
                <div class="w-1/2 flex justify-end pr-12">
                    <div
                        class="icon-wrapper w-20 h-20 rounded-full bg-gray-300 flex items-center justify-center transition-all duration-700">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                            class="h-13 w-13 stroke-current text-white">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                        </svg>
                    </div>
                </div>
                <div class="w-1/2 pl-12">
                    <h3 class="text-xl font-semibold text-black mb-2">3. Customize</h3>
                    <p class="text-gray-500">Upload your design or customize your item directly using our easy-to-use
                        editor to make it truly yours.</p>
                </div>
            </div>

            <div class="step-item flex items-center relative opacity-100 transition-all duration-700" data-step="4">
                <div class="w-1/2 text-right pr-12">
                    <h3 class="text-xl font-semibold text-black mb-2">4. Confirm Payment</h3>
                    <p class="text-gray-500">Review your order details carefully and proceed to confirm your payment
                        securely.</p>
                </div>
                <div class="w-1/2 flex justify-start pl-12">
                    <div
                        class="icon-wrapper w-20 h-20 rounded-full bg-gray-300 flex items-center justify-center transition-all duration-700">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                            class="h-13 w-13 stroke-current text-white">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z" />
                        </svg>
                    </div>
                </div>
            </div>

            <div class="step-item flex items-center relative opacity-100 transition-all duration-700" data-step="5">
                <div class="w-1/2 flex justify-end pr-12">
                    <div
                        class="icon-wrapper w-20 h-20 rounded-full bg-gray-300 flex items-center justify-center transition-all duration-700">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                            class="h-13 w-13 stroke-current text-white">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                        </svg>
                    </div>
                </div>
                <div class="w-1/2 pl-12">
                    <h3 class="text-xl font-semibold text-black mb-2">5. Production</h3>
                    <p class="text-gray-500">Once your order is confirmed, our team will start crafting your custom
                        product with attention and care in every detail.</p>
                </div>
            </div>

            <div class="step-item flex items-center relative opacity-100 transition-all duration-700" data-step="6">
                <div class="w-1/2 text-right pr-12">
                    <h3 class="text-xl font-semibold text-black mb-2">6. Delivery</h3>
                    <p class="text-gray-500">Your handcrafted product is on its way â€” securely packed and delivered
                        right to your doorstep with care.</p>
                </div>
                <div class="w-1/2 flex justify-start pl-12">
                    <div
                        class="icon-wrapper w-20 h-20 rounded-full bg-gray-300 flex items-center justify-center transition-all duration-700">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                            class="h-13 w-13 stroke-current text-white">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4" />
                        </svg>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<style>
    /* 1. Icon yang sudah dilewati (Completed): Tetap primary, tapi opacity lebih rendah */
    .icon-wrapper.completed {
        background-color: #3B82F6;
        /* Primary color */
        transform: scale(1);
        opacity: 0.4;
        /* Meredupkan icon/garis di belakangnya */
    }

    /* 2. Icon yang sedang aktif (Active): Nyala penuh */
    .icon-wrapper.active {
        transform: scale(1.1);
        background-color: #3B82F6;
        opacity: 1;
        /* Nyala penuh */
    }

    /* Icon default */
    .icon-wrapper {
        transition: background-color 0.4s ease, transform 0.3s ease, opacity 0.4s ease;
        opacity: 1;
    }

    /* 3. Garis progress: Selalu Nyala Penuh dan Smooth */
    #progressLine {
        opacity: 1;
        transition: height 0.6s ease-out;
    }
</style>

<script>
    const steps = document.querySelectorAll(".step-item");
    const progressLine = document.getElementById("progressLine");

    const PRIMARY_COLOR = '#3B82F6';
    const GRAY_COLOR = 'rgb(209, 213, 219)';

    let lastActiveStep = 0;
    let lastScrollY = window.scrollY;

    function updateProgress(activeStepNumber) {
        steps.forEach((step, index) => {
            const stepNum = index + 1;
            const icon = step.querySelector(".icon-wrapper");

            if (stepNum < activeStepNumber) {
                icon.classList.add("completed");
                icon.classList.remove("active", "bg-gray-300");
                icon.style.backgroundColor = PRIMARY_COLOR;
            } else if (stepNum === activeStepNumber) {
                icon.classList.add("active");
                icon.classList.remove("completed", "bg-gray-300");
                icon.style.backgroundColor = PRIMARY_COLOR;
            } else {
                icon.classList.remove("active", "completed");
                icon.classList.add("bg-gray-300");
                icon.style.backgroundColor = GRAY_COLOR;
            }
        });

        const currentStepCenterY = steps[activeStepNumber - 1].offsetTop + steps[activeStepNumber - 1].offsetHeight / 2;
        const startY = progressLine.parentElement.offsetTop;
        const progressTargetHeight = currentStepCenterY - startY;

        progressLine.style.height = progressTargetHeight + 'px';
        lastActiveStep = activeStepNumber;
    }

    const observer = new IntersectionObserver(entries => {
        const isScrollingDown = window.scrollY > lastScrollY;
        lastScrollY = window.scrollY;

        entries.forEach(entry => {
            const stepNumber = parseInt(entry.target.dataset.step);

            if (entry.isIntersecting && entry.intersectionRatio >= 0.5) {
                updateProgress(stepNumber);
            }
            // Kondisi mundur step hanya jika benar-benar scroll ke atas
            else if (!entry.isIntersecting && !isScrollingDown && stepNumber === lastActiveStep && stepNumber > 1) {
                updateProgress(stepNumber - 1);
            }
            // Abaikan kondisi scroll ke bawah pada step terakhir
            else if (stepNumber === steps.length && isScrollingDown) {
                // Tetap di step terakhir
                updateProgress(steps.length);
            }
        });
    }, {
        threshold: [0.5],
        rootMargin: '-40% 0px -40% 0px'
    });

    steps.forEach(step => observer.observe(step));

    window.addEventListener('load', () => {
        updateProgress(1);
    });

</script>